---
phase: 03-ui-composable-decomposition
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutTab.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HistoryAndSettingsTabs.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HistoryTab.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SettingsTab.kt
autonomous: true
must_haves:
  truths:
    - "HistoryAndSettingsTabs.kt no longer exists -- replaced by HistoryTab.kt and SettingsTab.kt"
    - "SetSummaryCard lives in its own file and is used by both HistoryTab and WorkoutTab without compile errors"
    - "All composables render identically -- this is a move-only refactoring with zero behavior changes"
    - "Build compiles and all existing tests pass"
  artifacts:
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt"
      provides: "SetSummaryCard + helpers (SummaryStatCard, SummaryForceCard, EchoPhaseBreakdownCard, PhaseStatColumn, formatFloat, Float.pow)"
      contains: "fun SetSummaryCard"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HistoryTab.kt"
      provides: "HistoryTab, WorkoutHistoryCard, CompletedSetsSection, GroupedRoutineCard, WorkoutSessionCard, MetricItem, EnhancedMetricItem, formatTimestamp, formatRelativeTimestamp, formatDuration"
      contains: "fun HistoryTab"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SettingsTab.kt"
      provides: "SettingsTab and DiscoModeUnlockDialog"
      contains: "fun SettingsTab"
  key_links:
    - from: "HistoryTab.kt"
      to: "SetSummaryCard.kt"
      via: "same-package function call"
      pattern: "SetSummaryCard\\("
    - from: "WorkoutTab.kt"
      to: "SetSummaryCard.kt"
      via: "same-package function call"
      pattern: "SetSummaryCard\\("
---

<objective>
Split HistoryAndSettingsTabs.kt (2,750 lines) into separate HistoryTab.kt and SettingsTab.kt files, after first extracting the cross-referenced SetSummaryCard to its own file.

Purpose: Eliminate the largest UI monolith by following the established one-major-composable-per-file pattern already used by RoutinesTab.kt, InsightsTab.kt, and ExercisesTab.kt.

Output: Three new files (SetSummaryCard.kt, HistoryTab.kt, SettingsTab.kt), one deleted file (HistoryAndSettingsTabs.kt), one modified file (WorkoutTab.kt with SetSummaryCard removed).
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ui-composable-decomposition/03-RESEARCH.md

Key source files:
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutTab.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HistoryAndSettingsTabs.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract SetSummaryCard and helpers from WorkoutTab.kt to SetSummaryCard.kt</name>
  <files>
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutTab.kt
  </files>
  <action>
CRITICAL: SetSummaryCard is referenced by BOTH WorkoutTab.kt AND HistoryAndSettingsTabs.kt. It MUST be extracted first before any other file splitting.

1. Create `SetSummaryCard.kt` in `presentation/screen/` with package `com.devil.phoenixproject.presentation.screen`.

2. Move these composables/functions from WorkoutTab.kt (approximately lines 1483-2040 and 2800-2816) into the new file:
   - `SetSummaryCard` (public, ~lines 1483-1778)
   - `SummaryStatCard` (private -> keep private in new file, ~lines 1779-1844)
   - `SummaryForceCard` (private -> keep private in new file, ~lines 1845-1910)
   - `EchoPhaseBreakdownCard` (private -> keep private in new file, ~lines 1911-1998)
   - `PhaseStatColumn` (private -> keep private in new file, ~lines 1999-2040)
   - `formatFloat` (private -> internal, ~lines 2800-2810) -- used by SetSummaryCard helpers
   - `Float.pow` extension (private -> internal, ~lines 2812-2816) -- used by formatFloat

3. Copy ONLY the imports needed by these composables into SetSummaryCard.kt. Do NOT copy the entire WorkoutTab.kt import block.

4. Remove the moved composables and functions from WorkoutTab.kt. Leave all other composables in place.

5. Verify that `formatReps` (private, ~line 2822) stays in WorkoutTab.kt -- it is used by CompletedCard, NOT by SetSummaryCard.

VISIBILITY RULES:
- `SetSummaryCard` stays public (already public, called from multiple files)
- `SummaryStatCard`, `SummaryForceCard`, `EchoPhaseBreakdownCard`, `PhaseStatColumn` stay private (only used within SetSummaryCard.kt)
- `formatFloat` becomes `internal` (may be used by WorkoutTab composables too -- check before deciding; if only used by SetSummaryCard helpers, keep private)
- `Float.pow` follows `formatFloat` visibility

DO NOT change any function signatures, parameter names, or implementation logic. This is a move-only operation.
  </action>
  <verify>
Run `./gradlew :shared:compileKotlinAndroid` to verify the build compiles. Both WorkoutTab.kt and HistoryAndSettingsTabs.kt should resolve SetSummaryCard from the same package without any import changes.
  </verify>
  <done>
SetSummaryCard.kt exists with SetSummaryCard + 4 private helpers + utility functions. WorkoutTab.kt no longer contains these composables. Build compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Split HistoryAndSettingsTabs.kt into HistoryTab.kt and SettingsTab.kt</name>
  <files>
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HistoryTab.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SettingsTab.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HistoryAndSettingsTabs.kt
  </files>
  <action>
DEPENDS ON Task 1 (SetSummaryCard must already be extracted).

**Step A: Create HistoryTab.kt**

1. Create `HistoryTab.kt` in `presentation/screen/` with package `com.devil.phoenixproject.presentation.screen`.

2. Move these composables from HistoryAndSettingsTabs.kt into HistoryTab.kt:
   - `HistoryTab` (public, ~lines 56-158)
   - `WorkoutHistoryCard` (public, ~lines 160-483)
   - `CompletedSetsSection` (private, ~lines 484-580) -- keep private, only used by WorkoutHistoryCard
   - `GroupedRoutineCard` (public, ~lines 581-962)
   - `WorkoutSessionCard` (public, ~lines 963-1011)
   - `MetricItem` (public, ~lines 1012-1027)
   - `EnhancedMetricItem` (public, ~lines 2709-2743)

3. Move these private utility functions into HistoryTab.kt:
   - `formatTimestamp` (~line 2697) -- keep private
   - `formatRelativeTimestamp` (~line 2704) -- keep private
   - `formatDuration` (~line 2744) -- keep private

4. Copy ONLY the imports needed by history composables. Audit each import -- do not blindly copy the full block.

**Step B: Create SettingsTab.kt**

5. Create `SettingsTab.kt` in `presentation/screen/` with package `com.devil.phoenixproject.presentation.screen`.

6. Move these composables from HistoryAndSettingsTabs.kt:
   - `SettingsTab` (public, ~lines 1029-2565)
   - `DiscoModeUnlockDialog` (private, ~lines 2570-2695) -- keep private, only used by SettingsTab

7. Copy ONLY the imports needed by settings composables.

**Step C: Delete HistoryAndSettingsTabs.kt**

8. After confirming all composables are moved, delete `HistoryAndSettingsTabs.kt` entirely. The file should be empty except for the package declaration and imports at this point.

VISIBILITY RULES:
- All public composables stay public
- `CompletedSetsSection` stays private (only used by WorkoutHistoryCard in same file)
- `DiscoModeUnlockDialog` stays private (only used by SettingsTab in same file)
- All format* utility functions stay private (only used within HistoryTab.kt)

DO NOT change any function signatures, parameter names, or implementation logic. This is a move-only operation.
  </action>
  <verify>
Run `./gradlew :shared:compileKotlinAndroid` to verify the build compiles. Then run `./gradlew :shared:testDebugUnitTest` to verify all characterization tests still pass. Confirm HistoryAndSettingsTabs.kt no longer exists (deleted).
  </verify>
  <done>
HistoryTab.kt exists (~1,180 lines) with all history composables and utilities. SettingsTab.kt exists (~1,570 lines) with SettingsTab and DiscoModeUnlockDialog. HistoryAndSettingsTabs.kt is deleted. Build compiles and all tests pass.
  </done>
</task>

</tasks>

<verification>
1. `./gradlew :shared:compileKotlinAndroid` -- build compiles with zero errors
2. `./gradlew :shared:testDebugUnitTest` -- all 38 characterization tests pass
3. `HistoryAndSettingsTabs.kt` does not exist (git status shows it deleted)
4. `SetSummaryCard.kt`, `HistoryTab.kt`, `SettingsTab.kt` exist as new files
5. `WorkoutTab.kt` is smaller (SetSummaryCard section removed, ~560 fewer lines)
6. No import changes needed in any file outside the split targets (same-package visibility)
</verification>

<success_criteria>
- HistoryAndSettingsTabs.kt is gone, replaced by HistoryTab.kt and SettingsTab.kt
- SetSummaryCard lives in its own file, referenced by both WorkoutTab and HistoryTab
- All composable signatures are identical (zero behavioral change)
- Build compiles and all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-ui-composable-decomposition/03-01-SUMMARY.md`
</output>
