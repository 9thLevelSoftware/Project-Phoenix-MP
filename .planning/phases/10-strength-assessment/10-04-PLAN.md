---
phase: 10-strength-assessment
plan: 04
type: execute
wave: 3
depends_on: ["10-03"]
files_modified:
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/navigation/NavGraph.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HomeScreen.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ExerciseDetailScreen.kt
autonomous: false

must_haves:
  truths:
    - "User can launch strength assessment from the home screen"
    - "User can launch strength assessment for a specific exercise from the exercise detail screen"
    - "Navigation to assessment wizard works correctly with and without pre-selected exercise"
    - "Full assessment flow is visually functional end-to-end"
  artifacts:
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/navigation/NavGraph.kt"
      provides: "Assessment wizard composable route registration"
      contains: "StrengthAssessment"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HomeScreen.kt"
      provides: "Assessment entry point button on home screen"
      contains: "strength_assessment"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ExerciseDetailScreen.kt"
      provides: "Assess 1RM button on exercise detail"
      contains: "strength_assessment"
  key_links:
    - from: "NavGraph.kt"
      to: "AssessmentWizardScreen"
      via: "composable route"
      pattern: "AssessmentWizardScreen"
    - from: "HomeScreen.kt"
      to: "NavigationRoutes.StrengthAssessmentPicker"
      via: "navController.navigate"
      pattern: "StrengthAssessmentPicker"
    - from: "ExerciseDetailScreen.kt"
      to: "NavigationRoutes.StrengthAssessment"
      via: "navController.navigate"
      pattern: "StrengthAssessment\\.createRoute"
---

<objective>
Wire the assessment wizard into app navigation and add entry points from the home screen and exercise detail screen, then verify the full flow visually.

Purpose: Connect the assessment wizard to the rest of the app so users can actually reach it. Add a "Strength Assessment" card/button on the home screen (ASSESS-01) and an "Assess 1RM" action on the exercise detail screen for launching assessment for a specific exercise.

Output: Fully navigable assessment flow with human-verified UI.
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-strength-assessment/10-03-SUMMARY.md
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/navigation/NavGraph.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/navigation/NavigationRoutes.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HomeScreen.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ExerciseDetailScreen.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/AssessmentWizardScreen.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/viewmodel/AssessmentViewModel.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register assessment routes in NavGraph and add entry points</name>
  <files>
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/navigation/NavGraph.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/HomeScreen.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ExerciseDetailScreen.kt
  </files>
  <action>
    In NavGraph.kt:
    - Add composable route for StrengthAssessmentPicker (no exercise pre-selected):
      composable(NavigationRoutes.StrengthAssessmentPicker.route) {
          val assessmentViewModel: AssessmentViewModel = koinInject()
          AssessmentWizardScreen(viewModel = assessmentViewModel, themeMode = themeMode, onNavigateBack = { navController.popBackStack() })
      }
    - Add composable route for StrengthAssessment (with exerciseId argument):
      composable(NavigationRoutes.StrengthAssessment.route, arguments = listOf(navArgument("exerciseId") { type = NavType.StringType })) { backStackEntry ->
          val exerciseId = backStackEntry.arguments?.getString("exerciseId") ?: ""
          val assessmentViewModel: AssessmentViewModel = koinInject()
          AssessmentWizardScreen(viewModel = assessmentViewModel, exerciseId = exerciseId, themeMode = themeMode, onNavigateBack = { navController.popBackStack() })
      }
    - Add standard slide transitions matching other routes (use the same enterTransition/exitTransition as JustLift route)
    - Import AssessmentWizardScreen and AssessmentViewModel

    In HomeScreen.kt:
    - Add a "Strength Assessment" entry card/button in the workout type selection area. Look at the existing home screen layout and add it as a secondary action card below the main workout options.
    - Style: Use an OutlinedCard or similar secondary treatment (not as prominent as main workout modes) with a fitness/assessment icon (Icons.Default.FitnessCenter or similar)
    - Title: "Strength Assessment"
    - Subtitle: "Find your 1RM"
    - On click: navController.navigate(NavigationRoutes.StrengthAssessmentPicker.route)

    In ExerciseDetailScreen.kt:
    - Add an "Assess 1RM" button/action. Find where the exercise details are displayed and add a Button or OutlinedButton labeled "Assess 1RM" that navigates to the assessment wizard with this exercise pre-selected.
    - navController.navigate(NavigationRoutes.StrengthAssessment.createRoute(exerciseId))
    - Only show this button if the device is connected (check viewModel's connection state), since assessment requires the machine. If not connected, show a disabled state with tooltip "Connect to trainer first".
  </action>
  <verify>
    Build passes: `./gradlew :shared:compileKotlinAndroid 2>&1 | tail -5` shows BUILD SUCCESSFUL.
    Full Android build: `./gradlew :androidApp:assembleDebug 2>&1 | tail -5` shows BUILD SUCCESSFUL.
  </verify>
  <done>Assessment wizard is reachable via navigation from both home screen (exercise picker flow) and exercise detail screen (pre-selected exercise). NavGraph routes registered with proper arguments and transitions.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete assessment wizard flow</name>
  <files>no files modified - verification only</files>
  <action>
    Human verification of the complete strength assessment wizard flow.
    Install debug APK and walk through the full assessment flow on device.
    See how-to-verify for detailed steps.
  </action>
  <verify>
    1. Install debug APK: `./gradlew :androidApp:installDebug`
    2. Open the app and verify the home screen shows a "Strength Assessment" card
    3. Tap "Strength Assessment" - should open exercise selection step
    4. Search/select an exercise - should show instruction step with video (if available) and guidance text
    5. Tap "Begin Assessment" - should show progressive loading step with suggested weight
    6. (Without machine) Manually enter a weight and velocity value, tap "Log Set" - should record set and show velocity color coding
    7. Log 2-3 sets with decreasing velocity values (e.g., 40kg/1.0, 60kg/0.7, 80kg/0.35)
    8. After logging a set with velocity below 0.3, should auto-transition to results showing estimated 1RM
    9. Verify the 1RM estimate looks reasonable
    10. Optionally enter an override value
    11. Tap "Accept and Save" - should show saving then complete screen
    12. Navigate to the exercise in the exercise library - verify 1RM value is updated
    13. Also test: navigate to an exercise detail screen and tap "Assess 1RM" to verify the pre-selected exercise flow works
  </verify>
  <done>Human confirms: assessment wizard flow works end-to-end, 1RM is calculated and saved correctly, entry points from home screen and exercise detail both function.</done>
</task>

</tasks>

<verification>
- `./gradlew :androidApp:assembleDebug` passes
- Home screen shows Strength Assessment entry point
- Exercise detail screen shows Assess 1RM button
- Full wizard flow navigates through all steps without crashes
- Assessment results are saved to database
- Exercise 1RM is updated after assessment completion
</verification>

<success_criteria>
- User can launch assessment from home screen and exercise detail screen
- Full wizard flow works: selection -> instruction -> progressive loading -> results -> save
- 1RM estimation produces reasonable values from logged set data
- Assessment saved as WorkoutSession with __ASSESSMENT__ marker
- Exercise oneRepMaxKg updated in database
- Human verification confirms flow is usable
</success_criteria>

<output>
After completion, create `.planning/phases/10-strength-assessment/10-04-SUMMARY.md`
</output>
