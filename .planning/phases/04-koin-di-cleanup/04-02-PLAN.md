---
phase: 04-koin-di-cleanup
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - shared/src/androidUnitTest/kotlin/com/devil/phoenixproject/di/KoinModuleVerifyTest.kt
  - androidApp/src/main/kotlin/com/devil/phoenixproject/AppModule.kt
autonomous: true

must_haves:
  truths:
    - "A Koin verify() test exists and passes, confirming all DI bindings in appModule resolve correctly"
    - "The dead androidApp AppModule.kt (empty module) is removed"
    - "The app starts and runs normally on Android after the full Koin reorganization"
  artifacts:
    - path: "shared/src/androidUnitTest/kotlin/com/devil/phoenixproject/di/KoinModuleVerifyTest.kt"
      provides: "Koin Module.verify() test for appModule"
      contains: "appModule.verify"
  key_links:
    - from: "shared/src/androidUnitTest/kotlin/com/devil/phoenixproject/di/KoinModuleVerifyTest.kt"
      to: "shared/src/commonMain/kotlin/com/devil/phoenixproject/di/AppModule.kt"
      via: "appModule.verify(extraTypes = ...)"
      pattern: "appModule\\.verify"
---

<objective>
Add a Koin Module.verify() test that validates all DI bindings resolve correctly, and clean up the dead androidApp AppModule.kt.

Purpose: Satisfies DI-02 (verify test) and completes DI-03 (app runs normally). The verify test provides ongoing safety -- any future binding change that breaks the DI graph will be caught by this test.

Output: New KoinModuleVerifyTest.kt in androidUnitTest, deletion of dead androidApp/AppModule.kt.
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-koin-di-cleanup/04-RESEARCH.md
@.planning/phases/04-koin-di-cleanup/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Koin Module.verify() test</name>
  <files>
    shared/src/androidUnitTest/kotlin/com/devil/phoenixproject/di/KoinModuleVerifyTest.kt
  </files>
  <action>
Create a new test file at `shared/src/androidUnitTest/kotlin/com/devil/phoenixproject/di/KoinModuleVerifyTest.kt`.

IMPORTANT: This MUST be in `androidUnitTest` (not `commonTest`) because Module.verify() uses JVM reflection.

```kotlin
package com.devil.phoenixproject.di

import com.devil.phoenixproject.data.local.DriverFactory
import com.devil.phoenixproject.data.repository.BleRepository
import com.devil.phoenixproject.util.ConnectivityChecker
import com.devil.phoenixproject.util.CsvExporter
import com.devil.phoenixproject.util.DataBackupManager
import com.russhwolf.settings.Settings
import org.junit.Test
import org.koin.test.verify.verify

class KoinModuleVerifyTest {

    @Test
    fun verifyAppModule() {
        appModule.verify(
            extraTypes = listOf(
                // Types provided by platformModule (not included in appModule)
                DriverFactory::class,
                Settings::class,
                BleRepository::class,
                CsvExporter::class,
                DataBackupManager::class,
                ConnectivityChecker::class,
            )
        )
    }
}
```

The `extraTypes` list contains all types that `platformModule` provides. These types are dependencies of bindings in appModule but are not declared within appModule itself -- they come from the platform-specific module loaded alongside appModule at startup. The verify() API needs to know about them so it doesn't report them as missing.

If verify() throws `MissingKoinDefinitionException` for additional types, add them to `extraTypes`. Common candidates:
- `android.content.Context` -- only if any commonModule binding needs it directly (currently none do)
- Any new types added to platformModule since research was done

Run `./gradlew :shared:testDebugUnitTest --tests "*.KoinModuleVerifyTest"` to confirm the test passes.
  </action>
  <verify>
Run `./gradlew :shared:testDebugUnitTest --tests "*.KoinModuleVerifyTest"` -- test passes.
  </verify>
  <done>KoinModuleVerifyTest exists in androidUnitTest, calls appModule.verify() with correct extraTypes, and passes.</done>
</task>

<task type="auto">
  <name>Task 2: Delete dead androidApp AppModule.kt and run full verification</name>
  <files>
    androidApp/src/main/kotlin/com/devil/phoenixproject/AppModule.kt
  </files>
  <action>
Delete the dead file `androidApp/src/main/kotlin/com/devil/phoenixproject/AppModule.kt`. This file contains an empty Koin module that is never referenced by KoinInit.kt or any other code. It was a placeholder from initial project setup.

Before deleting, confirm no code references it:
- Grep for `import com.devil.phoenixproject.appModule` or `import com.devil.phoenixproject.AppModule` across all .kt files
- Grep for `appModule` in `androidApp/` specifically (to distinguish from the shared module's `appModule`)

If any references exist, update them before deleting. Based on current analysis, there are zero references.

After deletion, run the full test suite and build:
1. `./gradlew :shared:testDebugUnitTest` -- all tests pass (including new verify test)
2. `./gradlew :androidApp:assembleDebug` -- app builds successfully
3. `./gradlew :androidApp:testDebugUnitTest` -- android app unit tests pass (if any exist)
  </action>
  <verify>
Run `./gradlew :shared:testDebugUnitTest` -- all tests pass.
Run `./gradlew :androidApp:assembleDebug` -- builds successfully.
File `androidApp/src/main/kotlin/com/devil/phoenixproject/AppModule.kt` no longer exists.
  </verify>
  <done>Dead androidApp AppModule.kt is deleted. Full test suite passes. Android app builds and the Koin DI reorganization is complete.</done>
</task>

</tasks>

<verification>
1. `./gradlew :shared:testDebugUnitTest` passes -- including KoinModuleVerifyTest
2. `./gradlew :androidApp:assembleDebug` succeeds
3. `androidApp/src/main/kotlin/com/devil/phoenixproject/AppModule.kt` does not exist
4. KoinModuleVerifyTest.kt exists at `shared/src/androidUnitTest/kotlin/com/devil/phoenixproject/di/`
5. No compilation warnings about unused imports in the di/ package
</verification>

<success_criteria>
Koin verify() test passes confirming all DI bindings resolve. Dead code is removed. Full build and test suite green.
</success_criteria>

<output>
After completion, create `.planning/phases/04-koin-di-cleanup/04-02-SUMMARY.md`
</output>
