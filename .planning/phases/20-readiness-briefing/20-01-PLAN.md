---
phase: 20-readiness-briefing
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/model/ReadinessModels.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/premium/ReadinessEngine.kt
  - shared/src/commonTest/kotlin/com/devil/phoenixproject/domain/premium/ReadinessEngineTest.kt
autonomous: true
requirements:
  - BRIEF-01

must_haves:
  truths:
    - "ReadinessEngine returns InsufficientData when training history is less than 28 days"
    - "ReadinessEngine returns InsufficientData when fewer than 3 sessions exist in the last 14 days"
    - "ReadinessEngine returns InsufficientData when chronic weekly volume is zero"
    - "ReadinessEngine returns a score 0-100 with GREEN/YELLOW/RED status for sufficient data"
    - "ACWR sweet spot (0.8-1.3) maps to high readiness (70-100), overreaching (>1.3) maps to lower scores"
    - "Volume calculation uses weightPerCableKg * 2 * workingReps (matching SmartSuggestionsEngine.totalKg)"
  artifacts:
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/model/ReadinessModels.kt"
      provides: "ReadinessStatus enum (GREEN, YELLOW, RED), ReadinessResult sealed class (InsufficientData, Ready)"
      contains: "enum class ReadinessStatus"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/premium/ReadinessEngine.kt"
      provides: "Pure stateless ACWR computation engine"
      exports: ["computeReadiness", "mapAcwrToScore"]
    - path: "shared/src/commonTest/kotlin/com/devil/phoenixproject/domain/premium/ReadinessEngineTest.kt"
      provides: "Unit tests covering data sufficiency guards, ACWR zones, edge cases"
      min_lines: 80
  key_links:
    - from: "ReadinessEngine.kt"
      to: "SessionSummary"
      via: "function parameter"
      pattern: "sessions: List<SessionSummary>"
    - from: "ReadinessEngine.kt"
      to: "ReadinessModels.kt"
      via: "return type"
      pattern: "ReadinessResult"
---

<objective>
Implement the ACWR-based readiness computation engine with comprehensive unit tests using TDD.

Purpose: BRIEF-01 requires a local readiness heuristic that computes a score (0-100) from existing workout session data, with data sufficiency guards preventing misleading scores for users with insufficient training history. This is a pure computation problem with well-defined inputs and outputs -- ideal for TDD.

Output: ReadinessEngine stateless object + ReadinessModels domain types + ReadinessEngineTest with full coverage.
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-readiness-briefing/20-RESEARCH.md

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->

From shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/model/SmartSuggestions.kt:
```kotlin
data class SessionSummary(
    val exerciseId: String,
    val exerciseName: String,
    val muscleGroup: String,
    val timestamp: Long,
    val weightPerCableKg: Float,
    val totalReps: Int,
    val workingReps: Int
)
```

From shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/premium/SmartSuggestionsEngine.kt (PATTERN TO FOLLOW):
```kotlin
// Pure computation engine - stateless object with pure functions
// No DB or DI dependencies. All time-dependent functions accept nowMs parameter for testability.
object SmartSuggestionsEngine {
    private const val SEVEN_DAYS_MS = 7 * 24 * 60 * 60 * 1000L
    private const val FOUR_WEEKS_MS = 28 * 24 * 60 * 60 * 1000L
    private const val FOURTEEN_DAYS_MS = 14 * 24 * 60 * 60 * 1000L
    private const val ONE_DAY_MS = 24 * 60 * 60 * 1000L

    fun computeWeeklyVolume(sessions: List<SessionSummary>, nowMs: Long): WeeklyVolumeReport { ... }
    // Volume formula: weightPerCableKg * 2 * workingReps
}
```

From shared/src/commonTest/kotlin/com/devil/phoenixproject/domain/premium/SmartSuggestionsEngineTest.kt (TEST PATTERN):
```kotlin
class SmartSuggestionsEngineTest {
    private val ONE_DAY_MS = 24 * 60 * 60 * 1000L
    private val NOW = 1_700_000_000_000L // Fixed reference time

    private fun session(
        exerciseId: String = "ex1",
        exerciseName: String = "Bench Press",
        muscleGroup: String = "Chest",
        timestamp: Long = NOW,
        weightPerCableKg: Float = 50f,
        totalReps: Int = 10,
        workingReps: Int = 8
    ) = SessionSummary(...)
}
```
</interfaces>
</context>

<feature>
  <name>ReadinessEngine ACWR Computation</name>
  <files>
    shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/model/ReadinessModels.kt,
    shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/premium/ReadinessEngine.kt,
    shared/src/commonTest/kotlin/com/devil/phoenixproject/domain/premium/ReadinessEngineTest.kt
  </files>
  <behavior>
    ReadinessEngine.computeReadiness(sessions, nowMs) returns ReadinessResult:

    Data sufficiency guards (all return InsufficientData):
    - Empty session list -> InsufficientData
    - Training history < 28 days (oldest session to now) -> InsufficientData
    - Fewer than 3 sessions in last 14 days -> InsufficientData
    - Chronic weekly volume is 0 -> InsufficientData

    ACWR computation (when data is sufficient):
    - Acute volume = sum(weightPerCableKg * 2 * workingReps) for sessions in last 7 days
    - Chronic volume = sum(weightPerCableKg * 2 * workingReps) for sessions in last 28 days, divided by 4 (weekly avg)
    - ACWR = acute / chronic

    Score mapping (mapAcwrToScore):
    - ACWR < 0.5 -> ~30 (significant under-training)
    - ACWR 0.5-0.8 -> 30-70 (increasing from under-training)
    - ACWR 0.8-1.3 -> 70-100 (sweet spot, peak near 1.0)
    - ACWR 1.3-1.5 -> 40-70 (overreaching)
    - ACWR > 1.5 -> 0-40 (danger zone)
    - Score always clamped to 0-100

    Status thresholds:
    - score >= 70 -> GREEN (ready to train normally)
    - score >= 40 -> YELLOW (train with caution)
    - score < 40 -> RED (consider lighter session)

    Ready result includes: score (Int), status (ReadinessStatus), acwr (Float), acuteVolumeKg (Float), chronicWeeklyAvgKg (Float)
  </behavior>
  <implementation>
    1. Create ReadinessModels.kt with ReadinessStatus enum and ReadinessResult sealed class
    2. Create ReadinessEngine.kt as a stateless object following SmartSuggestionsEngine pattern exactly
    3. Use the same time constants pattern (SEVEN_DAYS_MS, etc.)
    4. computeReadiness() takes List<SessionSummary> + nowMs: Long
    5. mapAcwrToScore() is internal for direct test access
    6. Tests use same factory pattern as SmartSuggestionsEngineTest (session() helper with defaults)
  </implementation>
</feature>

<verification>
```bash
cd C:/Users/dasbl/AndroidStudioProjects/Project-Phoenix-MP && ./gradlew :shared:testDebugUnitTest --tests "com.devil.phoenixproject.domain.premium.ReadinessEngineTest" --no-daemon 2>&1 | tail -20
```
All tests pass. Engine returns correct results for all ACWR zones and data sufficiency edge cases.
</verification>

<success_criteria>
- ReadinessEngineTest has 8+ test cases covering: empty sessions, insufficient history, insufficient recent sessions, zero chronic load, sweet spot ACWR, under-training ACWR, overreaching ACWR, danger zone ACWR
- All tests pass via `./gradlew :shared:testDebugUnitTest --tests "...ReadinessEngineTest"`
- ReadinessEngine.computeReadiness() returns InsufficientData for all four guard conditions
- ReadinessEngine.computeReadiness() returns Ready with correct score/status for valid data
- mapAcwrToScore() returns values clamped to 0-100 for all inputs
</success_criteria>

<output>
After completion, create `.planning/phases/20-readiness-briefing/20-01-SUMMARY.md`
</output>
