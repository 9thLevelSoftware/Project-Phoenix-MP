---
phase: 19-cv-form-check-ux-persistence
plan: 02
type: execute
wave: 2
depends_on:
  - 19-01
files_modified:
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/viewmodel/MainViewModel.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ActiveWorkoutScreen.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutTab.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/FormWarningBanner.kt
autonomous: true
requirements:
  - CV-01
  - CV-04
  - CV-10

must_haves:
  truths:
    - "Phoenix+ user can tap a Form Check toggle on the active workout HUD to enable/disable CV form checking"
    - "FREE user sees no Form Check toggle (tier gating via FeatureGate.CV_FORM_CHECK)"
    - "User sees real-time form violation corrective cues as a banner during active set when form check is enabled"
    - "iOS user sees a 'Form Check coming soon' dialog when tapping the toggle instead of activating the camera"
    - "User can view form score (0-100) in the set summary card after completing a set with form check enabled"
  artifacts:
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/FormWarningBanner.kt"
      provides: "Real-time form violation display composable"
      min_lines: 30
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt"
      provides: "Form check toggle button and FormCheckOverlay + FormWarningBanner wiring"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt"
      provides: "Form score display row in set summary"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/viewmodel/MainViewModel.kt"
      provides: "Form check state management exposed as StateFlow"
  key_links:
    - from: "MainViewModel"
      to: "WorkoutCoordinator._isFormCheckEnabled"
      via: "toggleFormCheck() updates flow"
      pattern: "toggleFormCheck|_isFormCheckEnabled"
    - from: "ActiveWorkoutScreen"
      to: "WorkoutTab"
      via: "isFormCheckEnabled state threaded through"
      pattern: "isFormCheckEnabled"
    - from: "WorkoutHud"
      to: "FormCheckOverlay"
      via: "onFormAssessment callback connected to viewModel"
      pattern: "FormCheckOverlay.*onFormAssessment"
    - from: "WorkoutHud"
      to: "FormWarningBanner"
      via: "latestFormViolations from WorkoutUiState"
      pattern: "FormWarningBanner.*violations"
    - from: "SetSummaryCard"
      to: "WorkoutState.SetSummary.formScore"
      via: "formScore display conditional on non-null"
      pattern: "formScore"
---

<objective>
Build the user-facing UI layer for CV Form Check: toggle button with tier gating and iOS guard, real-time form warning banner, FormCheckOverlay wiring, form score in SetSummary, and full state threading through the composable tree.

Purpose: Delivers the user-visible features (CV-01, CV-04, CV-10) on top of the data pipeline built in Plan 01. Users can enable form checking, see real-time warnings, and review their form score.
Output: FormWarningBanner composable, toggle in WorkoutHud, form score in SetSummaryCard, full state threading from MainViewModel through ActiveWorkoutScreen -> WorkoutTab -> WorkoutHud.
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-cv-form-check-ux-persistence/19-RESEARCH.md
@.planning/phases/19-cv-form-check-ux-persistence/19-01-SUMMARY.md

@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/viewmodel/MainViewModel.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ActiveWorkoutScreen.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutTab.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutUiState.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/FormCheckOverlay.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/manager/WorkoutCoordinator.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/domain/premium/FeatureGate.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/Platform.kt

<interfaces>
<!-- Key types and contracts from Plan 01 output + existing codebase. -->

From WorkoutUiState.kt (after Plan 01):
```kotlin
data class WorkoutUiState(
    // ... existing fields ...
    val hudPreset: String = "full",
    val isFormCheckEnabled: Boolean = false,
    val latestFormViolations: List<FormViolation> = emptyList(),
    val latestFormScore: Int? = null
)
```

From WorkoutCoordinator (after Plan 01):
```kotlin
val _isFormCheckEnabled: MutableStateFlow<Boolean>
val _latestFormViolations: MutableStateFlow<List<FormViolation>>
val _latestFormScore: MutableStateFlow<Int?>
```

From ActiveSessionEngine (after Plan 01):
```kotlin
fun onFormAssessment(assessment: FormAssessment)
```

From Models.kt (WorkoutState.SetSummary, after Plan 01):
```kotlin
data class SetSummary(
    // ... existing fields ...
    val biomechanicsSummary: BiomechanicsSetSummary? = null,
    val formScore: Int? = null  // NEW from Plan 01
) : WorkoutState()
```

From FormCheckOverlay.kt (expect declaration):
```kotlin
@Composable
expect fun FormCheckOverlay(
    isEnabled: Boolean,
    exerciseType: ExerciseFormType?,
    onFormAssessment: (FormAssessment) -> Unit,
    modifier: Modifier = Modifier
)
```

From FeatureGate.kt:
```kotlin
// FeatureGate.isEnabled(Feature.CV_FORM_CHECK, tier) -> Boolean
// CV_FORM_CHECK is gated to PHOENIX tier
```

From Platform.kt:
```kotlin
expect val isIosPlatform: Boolean
```

From WorkoutHud.kt (current signature):
```kotlin
fun WorkoutHud(
    activeState: WorkoutState.Active,
    metric: WorkoutMetric?,
    workoutParameters: WorkoutParameters,
    // ... many existing params ...
    hudPreset: String = HudPreset.FULL.key,
    modifier: Modifier = Modifier
)
```

From WorkoutTab.kt (overloaded, state-based signature):
```kotlin
fun WorkoutTab(
    state: WorkoutUiState,
    actions: WorkoutActions,
    exerciseRepository: ExerciseRepository,
    hapticEvents: SharedFlow<HapticEvent>? = null,
    modifier: Modifier = Modifier
)
```

From ActiveWorkoutScreen.kt (state collection pattern):
```kotlin
val subscriptionManager: SubscriptionManager = koinInject()
val hasProAccess by subscriptionManager.hasProAccess.collectAsState()
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: MainViewModel state exposure and FormWarningBanner composable</name>
  <files>
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/viewmodel/MainViewModel.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/FormWarningBanner.kt
  </files>
  <action>
    **1. Add form check state to MainViewModel:**
    In `MainViewModel.kt`, expose the WorkoutCoordinator form check flows as public StateFlows. Follow the exact pattern used for `latestRepQuality` and `latestBiomechanicsResult`:
    ```kotlin
    /** Whether CV form check is enabled by the user */
    val isFormCheckEnabled: StateFlow<Boolean> get() = coordinator._isFormCheckEnabled

    /** Latest form violations for real-time warning display */
    val latestFormViolations: StateFlow<List<FormViolation>> get() = coordinator._latestFormViolations

    /** Latest form score computed at set end */
    val latestFormScore: StateFlow<Int?> get() = coordinator._latestFormScore
    ```
    Add import for `FormViolation` from `com.devil.phoenixproject.domain.model`.

    **2. Add toggleFormCheck function to MainViewModel:**
    ```kotlin
    /** Toggle form check on/off. Only functional on Android for Phoenix+ users. */
    fun toggleFormCheck() {
        coordinator._isFormCheckEnabled.value = !coordinator._isFormCheckEnabled.value
    }
    ```

    **3. Add onFormAssessment delegation in MainViewModel:**
    Expose the ActiveSessionEngine's handler for composable callbacks:
    ```kotlin
    /** Forward form assessment from FormCheckOverlay to ActiveSessionEngine */
    fun onFormAssessment(assessment: FormAssessment) {
        activeSessionEngine.onFormAssessment(assessment)
    }
    ```
    Add import for `FormAssessment` from `com.devil.phoenixproject.domain.model`.

    **4. Create FormWarningBanner.kt composable:**
    Create `shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/FormWarningBanner.kt`:

    ```kotlin
    package com.devil.phoenixproject.presentation.components

    import androidx.compose.animation.AnimatedVisibility
    import androidx.compose.animation.fadeIn
    import androidx.compose.animation.fadeOut
    import androidx.compose.foundation.layout.Column
    import androidx.compose.foundation.layout.Row
    import androidx.compose.foundation.layout.Spacer
    import androidx.compose.foundation.layout.fillMaxWidth
    import androidx.compose.foundation.layout.padding
    import androidx.compose.foundation.layout.size
    import androidx.compose.foundation.layout.width
    import androidx.compose.foundation.shape.RoundedCornerShape
    import androidx.compose.material.icons.Icons
    import androidx.compose.material.icons.filled.Warning
    import androidx.compose.material3.Card
    import androidx.compose.material3.CardDefaults
    import androidx.compose.material3.Icon
    import androidx.compose.material3.MaterialTheme
    import androidx.compose.material3.Text
    import androidx.compose.runtime.Composable
    import androidx.compose.ui.Alignment
    import androidx.compose.ui.Modifier
    import androidx.compose.ui.text.font.FontWeight
    import androidx.compose.ui.unit.dp
    import com.devil.phoenixproject.domain.model.FormViolation
    import com.devil.phoenixproject.domain.model.FormViolationSeverity

    /**
     * Displays the highest-severity form violation as a corrective cue banner.
     * Shows during active sets when form check is enabled and violations are detected.
     *
     * Follows WCAG AA 1.4.1: Uses icon + text alongside color (BOARD-02 pattern).
     */
    @Composable
    fun FormWarningBanner(
        violations: List<FormViolation>,
        modifier: Modifier = Modifier
    ) {
        val topViolation = violations.maxByOrNull { it.severity.ordinal }

        AnimatedVisibility(
            visible = topViolation != null,
            enter = fadeIn(),
            exit = fadeOut(),
            modifier = modifier
        ) {
            topViolation?.let { violation ->
                val backgroundColor = when (violation.severity) {
                    FormViolationSeverity.CRITICAL -> MaterialTheme.colorScheme.errorContainer
                    FormViolationSeverity.WARNING -> MaterialTheme.colorScheme.tertiaryContainer
                    FormViolationSeverity.INFO -> MaterialTheme.colorScheme.surfaceVariant
                }
                val contentColor = when (violation.severity) {
                    FormViolationSeverity.CRITICAL -> MaterialTheme.colorScheme.onErrorContainer
                    FormViolationSeverity.WARNING -> MaterialTheme.colorScheme.onTertiaryContainer
                    FormViolationSeverity.INFO -> MaterialTheme.colorScheme.onSurfaceVariant
                }

                Card(
                    modifier = Modifier.fillMaxWidth(),
                    colors = CardDefaults.cardColors(
                        containerColor = backgroundColor,
                        contentColor = contentColor
                    ),
                    shape = RoundedCornerShape(8.dp)
                ) {
                    Row(
                        modifier = Modifier.padding(horizontal = 12.dp, vertical = 8.dp),
                        verticalAlignment = Alignment.CenterVertically
                    ) {
                        Icon(
                            imageVector = Icons.Filled.Warning,
                            contentDescription = when (violation.severity) {
                                FormViolationSeverity.CRITICAL -> "Critical form warning"
                                FormViolationSeverity.WARNING -> "Form warning"
                                FormViolationSeverity.INFO -> "Form info"
                            },
                            modifier = Modifier.size(20.dp),
                            tint = contentColor
                        )
                        Spacer(modifier = Modifier.width(8.dp))
                        Column {
                            Text(
                                text = violation.correctiveCue,
                                style = MaterialTheme.typography.labelMedium,
                                fontWeight = FontWeight.Bold,
                                color = contentColor
                            )
                        }
                    }
                }
            }
        }
    }
    ```

    This composable:
    - Shows the highest-severity violation's corrective cue (not all violations -- avoids UI clutter)
    - Uses animated visibility for smooth appearance/disappearance
    - Uses WCAG-compliant color + icon + text pattern (matches BOARD-02 accessibility requirement)
    - Severity maps to Material3 error/tertiary/surface color containers
  </action>
  <verify>
    <automated>cd C:/Users/dasbl/AndroidStudioProjects/Project-Phoenix-MP && ./gradlew :shared:compileKotlinAndroid 2>&1 | tail -5</automated>
  </verify>
  <done>
    - MainViewModel exposes isFormCheckEnabled, latestFormViolations, latestFormScore as StateFlow
    - MainViewModel has toggleFormCheck() and onFormAssessment() functions
    - FormWarningBanner.kt exists with animated violation display, severity-based colors, and WCAG icon+text pattern
    - Project compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Thread form check state through UI composable tree and wire toggle + overlays</name>
  <files>
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ActiveWorkoutScreen.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutTab.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt
  </files>
  <action>
    **1. ActiveWorkoutScreen -- Collect and thread form check state:**
    In `ActiveWorkoutScreen.kt`, add state collection after the existing `detectionState` line:
    ```kotlin
    val isFormCheckEnabled by viewModel.isFormCheckEnabled.collectAsState()
    val latestFormViolations by viewModel.latestFormViolations.collectAsState()
    val latestFormScore by viewModel.latestFormScore.collectAsState()
    ```
    Add import for `FormViolation` if not already present.

    Tier-gate the form check toggle visibility. After the existing `gatedBiomechanicsResult` line, add:
    ```kotlin
    // Form check - gated to Phoenix+ tier (CV-01)
    // Check FeatureGate instead of hasProAccess since CV_FORM_CHECK may be at a different tier
    val hasFormCheckAccess = remember(hasProAccess) {
        hasProAccess  // CV_FORM_CHECK is PHOENIX tier, same as hasProAccess
    }
    ```

    Thread these through to `WorkoutTab`. The `WorkoutTab(state: WorkoutUiState, ...)` overload already receives `WorkoutUiState`, so we need to ensure the `WorkoutUiState` object constructed in `ActiveWorkoutScreen` includes the new fields. Find where `WorkoutUiState(...)` is constructed (or where individual state values are passed to `WorkoutTab`) and add:
    - If using the `WorkoutUiState`-based `WorkoutTab` overload: ensure the `WorkoutUiState` collects from viewModel properly. The screen may construct `WorkoutUiState` directly or pass individual params -- follow whatever pattern is already used.
    - If using the individual-params `WorkoutTab` overload: add `isFormCheckEnabled`, `latestFormViolations`, `latestFormScore`, `hasFormCheckAccess`, and callback lambdas as new parameters.

    Also add callback lambdas:
    ```kotlin
    val onToggleFormCheck: () -> Unit = {
        if (isIosPlatform) {
            // CV-10: iOS shows "coming soon" dialog
            showFormCheckComingSoonDialog = true
        } else {
            viewModel.toggleFormCheck()
        }
    }
    val onFormAssessment: (FormAssessment) -> Unit = { assessment ->
        viewModel.onFormAssessment(assessment)
    }
    ```
    Add `var showFormCheckComingSoonDialog by remember { mutableStateOf(false) }` state.
    Add the iOS "coming soon" dialog:
    ```kotlin
    if (showFormCheckComingSoonDialog) {
        AlertDialog(
            onDismissRequest = { showFormCheckComingSoonDialog = false },
            title = { Text("Form Check") },
            text = { Text("Form Check is coming soon to iOS. Stay tuned!") },
            confirmButton = {
                TextButton(onClick = { showFormCheckComingSoonDialog = false }) {
                    Text("OK")
                }
            }
        )
    }
    ```
    Add imports for `AlertDialog`, `TextButton`, `isIosPlatform`, `FormAssessment`.

    **2. WorkoutTab -- Add form check parameters:**
    In `WorkoutTab.kt`, update BOTH overloads:

    For the `WorkoutUiState`-based overload: Extract `isFormCheckEnabled`, `latestFormViolations`, `latestFormScore` from `state` and pass them to the inner `WorkoutTab(...)` call. Add new parameters:
    ```kotlin
    isFormCheckEnabled: Boolean = false,
    hasFormCheckAccess: Boolean = false,
    latestFormViolations: List<FormViolation> = emptyList(),
    latestFormScore: Int? = null,
    onToggleFormCheck: () -> Unit = {},
    onFormAssessment: (FormAssessment) -> Unit = {},
    ```

    For the parameter-list overload: Add the same new parameters to the signature and thread them to `WorkoutHud` when `workoutState is WorkoutState.Active`.

    **3. WorkoutHud -- Add toggle button, FormCheckOverlay, and FormWarningBanner:**
    Add new parameters to `WorkoutHud`:
    ```kotlin
    isFormCheckEnabled: Boolean = false,
    hasFormCheckAccess: Boolean = false,
    latestFormViolations: List<FormViolation> = emptyList(),
    onToggleFormCheck: () -> Unit = {},
    onFormAssessment: (FormAssessment) -> Unit = {},
    ```

    **Toggle button (CV-01):**
    Add a Form Check toggle in the top bar area of WorkoutHud. Place it near the stop button or in a top-right position. Only show when `hasFormCheckAccess` is true (FREE users see nothing):
    ```kotlin
    if (hasFormCheckAccess) {
        IconToggleButton(
            checked = isFormCheckEnabled,
            onCheckedChange = { onToggleFormCheck() }
        ) {
            Icon(
                imageVector = if (isFormCheckEnabled)
                    Icons.Filled.Visibility else Icons.Filled.VisibilityOff,
                contentDescription = if (isFormCheckEnabled)
                    "Disable Form Check" else "Enable Form Check",
                tint = if (isFormCheckEnabled)
                    MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
    ```
    Add imports for `IconToggleButton`, `Icons.Filled.Visibility`, `Icons.Filled.VisibilityOff`.

    **FormCheckOverlay wiring (CV-04):**
    Add `FormCheckOverlay` to the WorkoutHud composition. It should be conditionally composed based on `isFormCheckEnabled` (not just hidden -- full decomposition triggers camera cleanup):
    ```kotlin
    if (isFormCheckEnabled) {
        FormCheckOverlay(
            isEnabled = true,
            exerciseType = workoutParameters.selectedExerciseId?.let { /* map to ExerciseFormType */ null },
            onFormAssessment = onFormAssessment,
            modifier = Modifier
                .size(width = 160.dp, height = 120.dp)
                .align(Alignment.TopEnd)
                .padding(top = 48.dp, end = 8.dp)
        )
    }
    ```

    For the `exerciseType` mapping: Create a utility function or inline mapping. Check if `WorkoutParameters` has a `selectedExerciseId` and map it. For now, since the exercise-to-form-type mapping is complex and exercise detection uses `Exercise.movement` patterns, pass `null` as the exercise type if no mapping exists yet -- `FormCheckOverlay.android.kt` already handles null exerciseType (it evaluates with default rules or skips exercise-specific rules). This can be refined in a follow-up.

    **FormWarningBanner (CV-04):**
    Add the `FormWarningBanner` within the WorkoutHud layout, positioned above the main HUD content (like a toast-style overlay). Only show when form check is enabled:
    ```kotlin
    if (isFormCheckEnabled) {
        FormWarningBanner(
            violations = latestFormViolations,
            modifier = Modifier
                .fillMaxWidth()
                .padding(horizontal = 16.dp, vertical = 4.dp)
        )
    }
    ```

    **4. SetSummaryCard -- Display form score:**
    In `SetSummaryCard.kt`, add form score display. The `summary: WorkoutState.SetSummary` parameter already has `formScore: Int?` (from Plan 01).

    After the existing biomechanics summary display section (or after the RPE section), add a form score row:
    ```kotlin
    // Form Check Score (CV-05)
    summary.formScore?.let { score ->
        Divider(modifier = Modifier.padding(vertical = 4.dp))
        Row(
            modifier = Modifier.fillMaxWidth().padding(horizontal = 16.dp),
            horizontalArrangement = Arrangement.SpaceBetween,
            verticalAlignment = Alignment.CenterVertically
        ) {
            Row(verticalAlignment = Alignment.CenterVertically) {
                Icon(
                    imageVector = Icons.Filled.Visibility,
                    contentDescription = "Form Score",
                    modifier = Modifier.size(18.dp),
                    tint = MaterialTheme.colorScheme.primary
                )
                Spacer(modifier = Modifier.width(6.dp))
                Text(
                    text = "Form Score",
                    style = MaterialTheme.typography.bodyMedium
                )
            }
            Text(
                text = "$score / 100",
                style = MaterialTheme.typography.titleMedium,
                fontWeight = FontWeight.Bold,
                color = when {
                    score >= 80 -> MaterialTheme.colorScheme.primary  // Good form
                    score >= 50 -> MaterialTheme.colorScheme.tertiary  // Needs work
                    else -> MaterialTheme.colorScheme.error  // Poor form
                }
            )
        }
    }
    ```
    Add imports for `Icons.Filled.Visibility`, `FontWeight`, `Divider`, `Arrangement`, `Spacer`.

    **CRITICAL STATE THREADING PATH:**
    The full chain must be:
    `MainViewModel.isFormCheckEnabled` -> `ActiveWorkoutScreen` (collectAsState) -> `WorkoutTab` (parameter) -> `WorkoutHud` (parameter) -> toggle button / FormCheckOverlay / FormWarningBanner

    And the callback chain:
    `WorkoutHud.onToggleFormCheck` -> `WorkoutTab.onToggleFormCheck` -> `ActiveWorkoutScreen.onToggleFormCheck` -> `viewModel.toggleFormCheck()` (or iOS dialog)
    `WorkoutHud.onFormAssessment` -> `WorkoutTab.onFormAssessment` -> `ActiveWorkoutScreen.onFormAssessment` -> `viewModel.onFormAssessment()`
  </action>
  <verify>
    <automated>cd C:/Users/dasbl/AndroidStudioProjects/Project-Phoenix-MP && ./gradlew :shared:compileKotlinAndroid :androidApp:compileDebugKotlin 2>&1 | tail -5</automated>
  </verify>
  <done>
    - Form check toggle visible on WorkoutHud for Phoenix+ users, hidden for FREE users (CV-01)
    - iOS tap shows "coming soon" dialog instead of activating camera (CV-10)
    - FormCheckOverlay conditionally composed when form check enabled, wired to onFormAssessment callback (CV-04)
    - FormWarningBanner displays corrective cues for highest-severity violation during active set (CV-04)
    - Form score row appears in SetSummaryCard when formScore is non-null (CV-05)
    - Full state threading chain verified from MainViewModel through ActiveWorkoutScreen -> WorkoutTab -> WorkoutHud
    - Full project compiles cleanly
  </done>
</task>

</tasks>

<verification>
1. `./gradlew :shared:compileKotlinAndroid :androidApp:compileDebugKotlin` succeeds
2. `grep -r "toggleFormCheck" shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/viewmodel/MainViewModel.kt` returns a match
3. `grep -r "FormWarningBanner" shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/` returns matches in FormWarningBanner.kt and WorkoutHud.kt
4. `grep -r "FormCheckOverlay" shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt` returns a match
5. `grep -r "formScore" shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt` returns a match
6. `grep -r "coming soon" shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ActiveWorkoutScreen.kt` returns a match for iOS dialog
7. `grep -r "isFormCheckEnabled" shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutTab.kt` confirms state threading
</verification>

<success_criteria>
- Phoenix+ users see Form Check toggle on WorkoutHud; FREE users see nothing
- Tapping toggle on iOS shows "Form Check coming soon" dialog
- Tapping toggle on Android enables FormCheckOverlay (camera preview with skeleton)
- Real-time form violations appear as corrective cue banner on WorkoutHud
- Form score appears in SetSummaryCard after set completion
- Full composable state chain compiles and threads correctly
- `./gradlew :androidApp:assembleDebug` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/19-cv-form-check-ux-persistence/19-02-SUMMARY.md`
</output>
