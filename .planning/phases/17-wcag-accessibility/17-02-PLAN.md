---
phase: 17-wcag-accessibility
plan: 02
type: execute
wave: 2
depends_on:
  - "17-01"
files_modified:
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/BiomechanicsHistoryCard.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/BalanceBar.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/RepQualityIndicator.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/ProgressionSuggestion.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/InsightCards.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/DashboardComponents.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/AutoDetectionSheet.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/RpeSlider.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/ProfileSpeedDial.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SmartInsightsTab.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ExerciseDetailScreen.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/JustLiftScreen.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/BadgesScreen.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/AssessmentWizardScreen.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ConnectionLogsScreen.kt
  - shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/EnhancedMainScreen.kt
autonomous: true
requirements:
  - BOARD-02

must_haves:
  truths:
    - "Velocity zone indicators display text labels (e.g., 'Explosive', 'Grind') alongside color coding, visible regardless of color-blind mode"
    - "Balance bar shows numeric asymmetry percentage beside the colored bar (not inside)"
    - "All color-coded indicators use AccessibilityColors from the theme instead of hardcoded hex values"
    - "Toggling color-blind mode in Settings changes all semantic colors app-wide (velocity zones, balance bar, rep quality, status indicators)"
    - "Standard mode (color-blind OFF) produces visually identical output to pre-phase colors for non-zone indicators"
  artifacts:
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt"
      provides: "Velocity zone colors from AccessibilityTheme.colors, zone text labels always visible"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/BalanceBar.kt"
      provides: "Asymmetry colors from AccessibilityTheme.colors, numeric percentage beside (not inside) bar"
    - path: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/RepQualityIndicator.kt"
      provides: "Rep quality score colors from AccessibilityTheme.colors"
  key_links:
    - from: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt"
      to: "shared/src/commonMain/kotlin/com/devil/phoenixproject/ui/theme/AccessibilityColors.kt"
      via: "velocityZoneColor() shared function + AccessibilityTheme.colors"
      pattern: "velocityZoneColor\\(|AccessibilityTheme\\.colors"
    - from: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/BalanceBar.kt"
      to: "shared/src/commonMain/kotlin/com/devil/phoenixproject/ui/theme/AccessibilityColors.kt"
      via: "AccessibilityTheme.colors.asymmetryGood/Caution/Bad"
      pattern: "AccessibilityTheme\\.colors\\.asymmetry"
    - from: "shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt"
      to: "shared/src/commonMain/kotlin/com/devil/phoenixproject/ui/theme/AccessibilityColors.kt"
      via: "velocityZoneColor() shared function replacing private zoneColor()"
      pattern: "velocityZoneColor\\("
---

<objective>
Retrofit all composables to use AccessibilityColors and add always-on secondary visual signals.

Purpose: Replace every hardcoded semantic color (green/red/yellow/amber for status, velocity zones, asymmetry severity, rep quality) with `AccessibilityTheme.colors` lookups, add always-on text labels to velocity zone indicators, and relocate the BalanceBar percentage text from inside to beside the bar. This completes BOARD-02 (WCAG AA 1.4.1 compliance).

Output: All 18+ composable files using AccessibilityColors instead of hardcoded hex values; velocity zone text labels visible at all times; balance bar numeric percentage beside the bar; zero hardcoded semantic color values remaining in the presentation layer.
</objective>

<execution_context>
@C:/Users/dasbl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/dasbl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-wcag-accessibility/17-RESEARCH.md
@.planning/phases/17-wcag-accessibility/17-01-SUMMARY.md

@shared/src/commonMain/kotlin/com/devil/phoenixproject/ui/theme/AccessibilityColors.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/BiomechanicsHistoryCard.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/BalanceBar.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/RepQualityIndicator.kt
@shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/ProgressionSuggestion.kt

<interfaces>
<!-- Key types and contracts from Plan 17-01 output -->

From shared/.../ui/theme/AccessibilityColors.kt (created in Plan 17-01):
```kotlin
@Immutable
data class AccessibilityColors(
    val success: Color, val error: Color, val warning: Color, val neutral: Color,
    val zoneExplosive: Color, val zoneFast: Color, val zoneModerate: Color, val zoneSlow: Color, val zoneGrind: Color,
    val asymmetryGood: Color, val asymmetryCaution: Color, val asymmetryBad: Color,
    val qualityExcellent: Color, val qualityGood: Color, val qualityFair: Color, val qualityBelowAverage: Color, val qualityPoor: Color,
    val statusGreen: Color, val statusYellow: Color, val statusRed: Color,
)

object AccessibilityTheme {
    val colors: AccessibilityColors @Composable @ReadOnlyComposable get() = LocalAccessibilityColors.current
    val isColorBlindMode: Boolean @Composable @ReadOnlyComposable get() = LocalColorBlindMode.current
}

// Shared utility -- replaces private zoneColor() in WorkoutHud, SetSummaryCard, and velocityZoneColor() in BiomechanicsHistoryCard
@Composable fun velocityZoneColor(zone: BiomechanicsVelocityZone): Color
fun velocityZoneLabel(zone: BiomechanicsVelocityZone): String
```

From shared/.../presentation/components/BalanceBar.kt:
```kotlin
// Current: Color-coded by severity with hardcoded Color(0xFF4CAF50), Color(0xFFFFC107), Color(0xFFF44336)
// Current: Percentage text centered INSIDE the bar
// Required: Colors from AccessibilityTheme.colors.asymmetryGood/Caution/Bad
// Required: Percentage text BESIDE the bar (per CONTEXT.md decision)
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Retrofit velocity zone and balance bar composables with AccessibilityColors and secondary signals</name>
  <files>
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/WorkoutHud.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SetSummaryCard.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/BiomechanicsHistoryCard.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/BalanceBar.kt
  </files>
  <action>
**WorkoutHud.kt:**
1. DELETE the private `zoneColor()` function (around line 1049). Replace ALL call sites with the shared `velocityZoneColor(zone)` from `AccessibilityColors.kt`. Import `com.devil.phoenixproject.ui.theme.velocityZoneColor`.
2. WHERE velocity zones are displayed (the zone stat column around line 873 that uses `zone.name`), add `velocityZoneLabel(zone)` text alongside the color indicator. Import `com.devil.phoenixproject.ui.theme.velocityZoneLabel`. The label should be visible ALWAYS (not gated by color-blind mode). Use a `StatColumn` or inline `Text` showing the human-friendly label ("Explosive", "Fast", etc.) rather than the enum name ("EXPLOSIVE").
3. For any other hardcoded `Color(0xFF...)` values that represent semantic meaning (success/error colors used for velocity), replace with `AccessibilityTheme.colors.*` lookups.

**SetSummaryCard.kt:**
1. DELETE the private `zoneColor()` function (around line 628). Replace ALL call sites with the shared `velocityZoneColor(zone)`. Import from `com.devil.phoenixproject.ui.theme.velocityZoneColor`.
2. WHERE velocity zone distribution is displayed, add `velocityZoneLabel(zone)` text alongside color-coded elements so zone names are always visible. Import `com.devil.phoenixproject.ui.theme.velocityZoneLabel`.

**BiomechanicsHistoryCard.kt:**
1. DELETE the private `velocityZoneColor()` function (around line 62) and the private `velocityZoneLabel()` function (around line 87). These are now in `AccessibilityColors.kt` as shared utilities. Replace all call sites. Import both from `com.devil.phoenixproject.ui.theme`.
2. Ensure zone labels are displayed alongside zone colors (they already are in this file -- verify they still work after the import change).

**BalanceBar.kt:**
1. Replace hardcoded asymmetry colors:
   - `Color(0xFF4CAF50)` (green, <10%) -> `AccessibilityTheme.colors.asymmetryGood`
   - `Color(0xFFFFC107)` (yellow, 10-15%) -> `AccessibilityTheme.colors.asymmetryCaution`
   - `Color(0xFFF44336)` (red, >15%) -> `AccessibilityTheme.colors.asymmetryBad`
   - Alert border `Color(0xFFF44336)` -> `AccessibilityTheme.colors.asymmetryBad`
2. RELOCATE the asymmetry percentage text from centered INSIDE the bar to BESIDE the bar (per CONTEXT.md decision: "Numeric value beside the bar, not inside, to avoid overlap at extreme values"). Move the `${asymmetryPercent.toInt()}%` Text from the `Box(contentAlignment = Center)` overlay to a position adjacent to the bar (e.g., as a Text in the same Row, to the right of the bar).
3. The existing numeric percentage display is already always-on (not gated by color-blind mode), which is correct. Just move its position.

IMPORTANT: When using `AccessibilityTheme.colors`, the function/lambda calling it must be `@Composable` since it reads from a CompositionLocal. If a color is needed in a non-composable context (e.g., a `Canvas` `drawScope`), resolve the color to a local val before the Canvas block:
```kotlin
val goodColor = AccessibilityTheme.colors.asymmetryGood  // resolve in @Composable scope
Canvas { /* use goodColor here */ }
```
  </action>
  <verify>
    <automated>cd C:/Users/dasbl/AndroidStudioProjects/Project-Phoenix-MP && ./gradlew :shared:compileCommonMainKotlinMetadata 2>&1 | tail -5</automated>
  </verify>
  <done>WorkoutHud, SetSummaryCard, BiomechanicsHistoryCard use shared velocityZoneColor()/velocityZoneLabel() from AccessibilityColors.kt (no more private duplicate functions). Velocity zone text labels are always visible alongside color indicators. BalanceBar uses AccessibilityTheme.colors for severity colors. BalanceBar numeric percentage is beside the bar, not inside. All compile without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Retrofit remaining composables to use AccessibilityColors</name>
  <files>
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/RepQualityIndicator.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/ProgressionSuggestion.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/InsightCards.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/DashboardComponents.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/AutoDetectionSheet.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/RpeSlider.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/components/ProfileSpeedDial.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/SmartInsightsTab.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ExerciseDetailScreen.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/JustLiftScreen.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/BadgesScreen.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/AssessmentWizardScreen.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/ConnectionLogsScreen.kt
    shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/screen/EnhancedMainScreen.kt
  </files>
  <action>
Systematic sweep of all remaining presentation files that use hardcoded semantic colors. For EACH file, replace hardcoded color values with `AccessibilityTheme.colors` lookups:

**RepQualityIndicator.kt** (highest priority):
- `scoreColor()` function (around line 33-39) uses a gradient of green -> yellow -> orange -> red for rep quality scores
- Replace with `AccessibilityTheme.colors.qualityExcellent/Good/Fair/BelowAverage/Poor`
- The `scoreColor()` function must become `@Composable` since it now reads CompositionLocal
- Update all call sites of `scoreColor()` accordingly

**ProgressionSuggestion.kt:**
- Uses `Color(0xFF4CAF50)` (green for positive suggestions) and `Color(0xFFE53935)` (red for warnings/deload)
- Replace with `AccessibilityTheme.colors.success` and `AccessibilityTheme.colors.error`

**For each remaining file (InsightCards, DashboardComponents, AutoDetectionSheet, RpeSlider, ProfileSpeedDial, SmartInsightsTab, ExerciseDetailScreen, JustLiftScreen, BadgesScreen, AssessmentWizardScreen, ConnectionLogsScreen, EnhancedMainScreen):**
1. Open the file and identify any `Color(0xFF4CAF50)`, `Color(0xFFF44336)`, `Color(0xFFE53935)`, `Color(0xFF22C55E)`, `Color(0xFFEF4444)`, `Color(0xFFFFC107)`, `Color(0xFFFDD835)`, or `Color(0xFFFF9800)` values that convey semantic meaning (success, error, warning, good/bad status)
2. Replace with the appropriate `AccessibilityTheme.colors.*` property
3. If the color is used in a non-composable lambda (like `Canvas.onDraw`), resolve it to a local val in the enclosing `@Composable` scope before the lambda

**What NOT to replace:**
- Brand colors (Phoenix orange, ember yellow, ash blue) used for visual identity -- these stay hardcoded
- Material theme colors accessed via `MaterialTheme.colorScheme.error` -- these are Material tokens and are fine
- Purely decorative colors that don't convey information (background tints, dividers, etc.)
- Colors in `Color.kt` or `DataColors.kt` -- these are color definitions, not usages. The `SignalSuccess`/`SignalError`/`SignalWarning` constants in `Color.kt` can remain as reference values; the point is that composables read from `AccessibilityTheme.colors` instead of these constants directly

**After all replacements,** run a verification grep to confirm no remaining hardcoded semantic colors in the presentation layer:
```bash
grep -rn "Color(0xFF4CAF50)\|Color(0xFFF44336)\|Color(0xFFE53935)\|Color(0xFF22C55E)\|Color(0xFFEF4444)" \
  shared/src/commonMain/kotlin/com/devil/phoenixproject/presentation/
```
This should return zero hits (or only hits in non-semantic contexts like brand/decorative colors).

IMPORTANT: Remember the `@Composable` constraint. Any function that now calls `AccessibilityTheme.colors` must be `@Composable`. If a private helper function like `scoreColor(score: Float): Color` was previously non-composable, it must become `@Composable` and all its call sites must already be in `@Composable` scope.
  </action>
  <verify>
    <automated>cd C:/Users/dasbl/AndroidStudioProjects/Project-Phoenix-MP && ./gradlew :androidApp:assembleDebug 2>&1 | tail -10</automated>
  </verify>
  <done>All presentation-layer composables use AccessibilityTheme.colors instead of hardcoded semantic hex values. RepQualityIndicator uses quality* colors. ProgressionSuggestion uses success/error colors. Remaining files migrated. Full Android build compiles successfully. Grep for hardcoded semantic colors in presentation/ returns zero hits (or only non-semantic decorative uses).</done>
</task>

</tasks>

<verification>
1. `./gradlew :androidApp:assembleDebug` compiles successfully
2. Grep for private `zoneColor()` in WorkoutHud.kt and SetSummaryCard.kt returns zero hits (removed)
3. Grep for private `velocityZoneColor()` and `velocityZoneLabel()` in BiomechanicsHistoryCard.kt returns zero hits (moved to shared)
4. Grep for `AccessibilityTheme.colors` in presentation/ returns 15+ hits across files
5. Grep for `velocityZoneLabel(` in WorkoutHud.kt and SetSummaryCard.kt confirms text labels are displayed
6. BalanceBar.kt no longer has percentage text inside the bar Canvas; percentage appears beside the bar
7. Zero hardcoded `Color(0xFF4CAF50)`, `Color(0xFFF44336)`, `Color(0xFFE53935)` in presentation/ files (semantic colors only)
</verification>

<success_criteria>
- All velocity zone indicators display text labels ("Explosive", "Fast", "Moderate", "Slow", "Grind") alongside color coding, visible in both standard and color-blind modes
- Balance bar shows numeric asymmetry percentage beside the bar (not inside)
- All color-coded indicators use AccessibilityColors from the theme -- no hardcoded semantic hex values in presentation layer
- Toggling color-blind mode in Settings changes all semantic colors app-wide
- Standard mode (color-blind OFF) produces visually identical output to pre-phase behavior for non-velocity-zone indicators (velocity zones intentionally reconciled to VBT-standard mapping)
- Full project compiles on Android
</success_criteria>

<output>
After completion, create `.planning/phases/17-wcag-accessibility/17-02-SUMMARY.md`
</output>
